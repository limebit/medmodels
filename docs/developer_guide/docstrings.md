# Writing Documentation for MedModels

## Documenting Code

To ensure that the code documentation for the `MedModels` package is clear, comprehensive, and automatically generated by Sphinx, follow these guidelines for writing docstrings. Note that the package uses [Google style docstrings](https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html) and supports [Sphinx and RST syntax](https://sphinx-tutorial.readthedocs.io/cheatsheet/).

## Working on the Documentation

First, ensure you have checked out medmodels and installed the documentation environment by executing `make install-docs` from the repository root.

You can serve the documentation live while developing locally to verify that changes to the docstrings are rendered correctly. To do this, simply run `make docs-serve`. This command will serve the documentation and automatically refresh and rebuild the local documentation page whenever changes are saved to any of the package or documentation files.

By calling `make docs-clean`, you can delete all generated docs files again.

## Structuring Docstrings

A well-structured docstring should include the following sections in this order:

1. [**Summary Line**](#summary-line)
2. [**Description**](#description)
3. [**Arguments**](#arguments)
4. [**Return Types**](#return-types)
5. [**Examples**](#examples)
6. [**Raises**](#raises)

### Summary Line

The summary line provides a brief description of what the function or class does. It should be a single line ending with a period. The summary needs to be on the same line as the opening `"""`.

Example:

```{literalinclude} example_docstrings.py
:lines: 1-5, 6-38
:emphasize-lines: 13
```

:::{admonition} No Linebreaks In Summary Line
:type: note
The summary line cannot contain line breaks and must not exceed the maximum line length. Ensure that the summary line provides a brief description of the function's purpose. Further explanation and details can be given in the [Description](#description) text block underneath.
:::

### Description

The description should be detailed and may contain various rich information elements such as mathematical expressions, external references, URLs, admonitions, etc.

``````{tab-set}

`````{tab-item} Math/Latex

Code:
```{code-block} python
"""
This function calculates the energy using the formula :math:`E = mc^2`.

You can also declare the math expression as:

.. math::
  E = mc^2

"""
```

````{admonition} Result
:class: seealso
This function calculates the energy using the formula $E = mc^2$:

You can also declare the math expression as:
```{eval-rst}
.. math::
  E = mc^2
```
````


`````

`````{tab-item} External Ref.

The docstring setup supports some special cases of external references:

Code:
```{code-block} python
"""
For more details, refer to the publication DOI: :doi:`10.31235/osf.io/dx87u`.
This issue is tracked under :gh-issue:`156`.
Contributed by :gh-user:`octocat`.
"""
```

````{admonition} Result
:class: seealso

For more details, refer to the publication DOI: <doi:10.31235/osf.io/dx87u>. \
This issue is tracked under <gh-issue:156>. \
Contributed by <gh-user:octocat>.
````
`````

`````{tab-item} URLs

Include URLs directly in the description

Code:
```{code-block} python
"""
Visit the `MedModels <https://medmodels.de>`_ for more information.
"""
```

````{admonition} Result
:class: seealso

Visit [MedModels](https://medmodels.de) for more information.

````
`````

`````{tab-item} Admonitions

You can add admonitions for important information. For more details check out the [official docs](https://docutils.sourceforge.io/docs/ref/rst/directives.html#admonitions).

Code:
```{code-block} python
"""
.. attention::
    attention!

.. caution::
    caution!

.. danger::
    danger!

.. error::
    error!

.. hint::
    hint!

.. important::
    important!

.. note::
    note!

.. tip::
    tip!

.. warning::
    warning!

"""
```

````{admonition} Result
:class: seealso

```{attention}
attention!
```

```{caution}
caution!
```

```{danger}
danger!
```

```{error}
error!
```

```{hint}
hint!
```

```{important}
important!
```

```{note}
note!
```

```{tip}
tip!
```

```{warning}
warning!
```
````
`````

`````{tab-item} More

**Other reST Elements:**

You can also use various other reST elements to enrich the documentation:

- **Lists:** For bullet points or numbered lists.
- **Code Blocks:** For including code snippets.
- **Tables:** For tabular data.

Refer to the [Sphinx & RST Cheat Sheet](https://sphinx-tutorial.readthedocs.io/cheatsheet/) for more examples and details.

`````
``````

### Arguments

Document parameters under the `Args` section. Each parameter should include its name, type, and a brief description.

Example:

```{literalinclude} example_docstrings.py
:lines: 1-5, 6-38
:emphasize-lines: 18-26
```

:::{admonition} No Linebreak in Type Definitions
:type: note

When writing type definitions in argument docstrings, avoid placing line breaks inside the type annotations. For instance, complex types like `(Union[str, List[str], Dict[str, Any]])` should appear on a single line without splitting across lines. This ensures the type definition remains clear and avoids parsing issues.

If a type definition exceeds the maximum line length limit, deactivate the line length rule for that doctstring using [`# noqa: W505`](https://docs.astral.sh/ruff/rules/line-too-long/#error-suppression) after the closing `"""`. This keeps the type annotation intact while preventing the linter from flagging the long line as an error.
:::

:::{admonition} No Boolean Argument Types
:type: note
Avoid using booleans as function arguments due to the "boolean trap". Booleans reduce code clarity, as `True` or `False` doesn't explain meaning. They also limit future flexibility â€” if more than two options are needed, changing the argument type can cause breaking changes. Instead, use an enum or a more descriptive type for better clarity and flexibility.

For more information, you can refer to [Adam Johnson's article](https://adamj.eu/tech/2021/07/10/python-type-hints-how-to-avoid-the-boolean-trap/) which discusses this in detail and provides examples of how to avoid the boolean trap.
:::

### Return Types

Document return types under the `Returns` section. Each return type should include the type and a brief description.

Example:

```python
def example_function(param1, param2):
    """This function performs an example operation.

    Returns:
        bool: True if successful, False otherwise.
    """
```

:::{admonition} Don't Document `None` Return Value
:type: note
Don't add a `Returns` section when the function has no return value (`def fun() -> None`)
:::

### Examples

Provide examples under the `Examples` section by using Sphinx's `.. code-block::` directive within the docstrings.
You need to decalare two `.. code-block` sections per example. The first one to shows the executed python code. The second one shows the output.

1. Execute block

The first code block needs to start as shown below. It sets the code highlighting to `python` and activates line numbers with `:linenos:`.

```{code}

.. code-block:: python
            :linenos:

            <python code>

```

1. Result block

The second block shows the return value when executing the code. The output value(s) should be entered after `>>>`.

```{code}

.. code-block:: python

            >>> Output

```

Full Example:

```python
def example_function(param1, param2):
    """This function performs an example operation.

    Examples:

        1. Example

        .. code-block:: python
            :linenos:

            example_function(
                arg0=1,
                arg1="A"
            )

        .. code-block:: python

            >>> True

    """
```

Will be shown in the API Docs as:

````{admonition} Examples
:class: example

```{eval-rst}

1. Example:

.. code-block:: python
    :linenos:

    example_function(
        arg0=1,
        arg1="A"
    )

.. code-block:: python

    >>> True

```
````

Check out the docs of [find_node_in_time_window()](medmodels.treatment_effect.temporal_analysis.find_node_in_time_window) for a real example.

### Raises

Document any exceptions that the function or class might raise under the `Raises` section.

Example:

```python
def example_function(param1, param2):
    """This function performs an example operation.

    Raises:
        ValueError: If `param1` is not an integer.
    """
```
